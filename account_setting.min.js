/*!
 * project : account_setting
 * author : LINOFFICE
 * 계정 관리
 */ let account_setting_singleton=null,account_setting_singletonEnforcer="singletonEnforcer";class AccountSetting{constructor(a){if(a!==account_setting_singletonEnforcer)throw"Cannot--construct singleton";this.init()}static get instance(){return account_setting_singleton||(account_setting_singleton=new AccountSetting(account_setting_singletonEnforcer)),account_setting_singleton}init(){let a=this;a.wrap=document.querySelector("#container"),a.change_lock=!1,a.template(),a.addEvents()}template(){let a=this,s=`<div class="wrap-contents main"><div class="user-cards"><div><div class="card user-info v-align"><div class="card__container"><a class="profile-image"><span class="img"><i></i></span></a><div class="profile-card"><h2 class="user-name">${account?account.name:`손님`}</h2></div></div></div><div class="card change-pwd v-align"><div class="card__container"><a class="title"><h2>비밀번호</h2><span class="link"><i class="btn btn-select"></i></span></a><div class="content"><div class="vertical-container"><div class="vertical-box"><p>고객님의 소중한 개인정보 보호를 위해<br>최소 6개월에 1회 이상 비밀번호를 변경해 주세요.</p></div></div></div></div></div><div class="card my-nshop v-align"><div class="card__container"><div class="content"><div class="vertical-container"><div class="vertical-box"><ul class="list"><li><p><span class="name">코인</span><span class="value">${account?commaAdd(account.ncoin):0}</span></p></li><li><p><span class="name">포인트</span><span class="value">${account?commaAdd(account.npoint):0}</span></p></li></ul></div></div></div></div></div></div></div></div>`;a.wrap.innerHTML=s,document.querySelector(".change-pwd .card__container .title").addEventListener("click",s=>{a.showChangePassword()})}showChangePassword(){let a=this,s=`<div id="password_area"><div><div class="pwd_header"><h2 class="header-title">비밀번호 변경</h2><a class="btn-prev"><i>prev</i></a></div><div class="content-section page-myinfo"><div class="desc"><h3>고객님의 소중한 개인정보 보호를 위해 주기적으로 비밀번호를 변경해 주세요.</h3></div><input id="current-account" name="current-account" type="hidden" value="${account?account.name:`손님`}"><div class="input-group current"><label for="current-password"></label><div class="input-field"><div class="input-wrap"><input id="current-password" name="currentPassword" type="password" placeholder="현재 비밀번호" maxlength="16" autocomplete="off" autocapitalize="off" tabindex="0"></div></div></div><div class="input-group"><label for="new-password"></label><div class="input-field password"><div class="input-wrap"><input id="new-password" type="password" placeholder="새 비밀번호" maxlength="16" autocomplete="off" autocapitalize="off"></div></div><div class="msg">6 ~ 16자 영문 대소문자, 숫자를 조합해 주세요.</div></div><div class="input-group"><label for="new-password-confirm"></label><div class="input-field"><div class="input-wrap"><input id="new-password-confirm" name="newPasswordConfirm" type="password" placeholder="새 비밀번호 확인" maxlength="16" autocomplete="off" autocapitalize="off" tabindex="0"></div></div><div class="msg default"></div></div><div class="btn-wrap"><button type="submit" class="btn-primary half"><span>확인</span></button><button type="button" class="btn-cancel half"><span>취소</span></button></div></div>`;$(".user-cards").hide(),$(".wrap-contents.main").append(s),document.querySelector("#password_area .btn-prev").addEventListener("click",a=>{$("#password_area").remove(),$(".user-cards").show()}),document.querySelector("#password_area .btn-cancel").addEventListener("click",a=>{$("#password_area").remove(),$(".user-cards").show()}),document.querySelector("#password_area .btn-primary").addEventListener("click",s=>{a.changePassword()})}changePassword(){let a=this,s=$("#current-password").val(),e=$("#new-password").val(),n=$("#new-password-confirm").val(),t=/^[a-zA-Z0-9]*$/;if(!s||s.length<6||!t.test(s)){$("#current-password").focus(),$(".msg.default").text("현재 비밀번호가 올바르지 않습니다.");return}if(!e||e.length<6||!t.test(e)){$("#new-password").focus(),$(".msg.default").text("새 비밀번호가 올바르지 않습니다.");return}if(!n||n.length<6||!t.test(n)||e!==n){$("#new-password-confirm").focus(),$(".msg.default").text("새 비밀번호 확인이 올바르지 않습니다.");return}if(s===e){$("#new-password").focus(),$(".msg.default").text("동일한 비밀번호로는 변경할 수 없습니다.");return}a.param={current_account:$("#current-account").val(),current_password:s,new_password:e},!a.change_lock&&(a.change_lock=!0,getDatasWithOption([{type:"POST",url:"/define/account/changepassword",dataType:"json",contentType:"application/json",Accept:"application/json",data:a.param}],s=>{switch(s){case 1:ncuim_modal_show("정상적으로 변경되었습니다.",null,"$('#password_area').remove();$('.user-cards').show();");break;case 2:ncuim_modal_show("파라미터가 누락되었습니다.");break;case 3:ncuim_modal_show("비밀번호가 올바르지 않습니다.");break;case 4:ncuim_modal_show("디비 업데이트에 실패하였습니다.");break;default:ncuim_modal_show("변경에 실패하였습니다.")}a.change_lock=!1},s=>{a.change_lock=!1}))}addEvents(){$(".scrollbar-macosx").scrollbar(),document.querySelector(".wrap header .btn_close").addEventListener("click",a=>{window.self.close()})}}AccountSetting.instance;