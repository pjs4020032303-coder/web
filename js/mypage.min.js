/*!
 * project : mypage
 * author : LINOFFICE
 * 마이페이지
 */ let my_singleton=null,my_singletonEnforcer="singletonEnforcer";class Mypage{constructor(e){if(e!==my_singletonEnforcer||!account||!account.firstChar)throw"Cannot--construct singleton";this.init()}static get instance(){return my_singleton||(my_singleton=new Mypage(my_singletonEnforcer)),my_singleton}init(){let e=this;switch(tabType||(tabType="char"),$("a[data-type="+tabType+"]").addClass("on"),e.main_character=account.firstChar,tabType){case"inv":e.inventory();break;case"mail":e.mail();break;case"board":e.board();break;case"comment":e.comment();break;default:e.character()}e.addEvents()}character(){let e=this;e.pledge=e.main_character.pledge,$(".section-my-character.char-info strong").html(e.pledge?`${e.pledge.name}(${e.pledge.leader_name})&nbsp;/&nbsp;포인트&nbsp;${e.pledge.contribution}&nbsp;/&nbsp;혈맹원수&nbsp;${e.pledge.member_size}/50명`:`없음`),account.gm&&$("#gm-info").html('<i style="color: #aa8060;">관리자</i>'),$(".section-my-character.char-level .box .level-info").html(`<strong>${e.main_character.level}Lv.</strong><span class="figure">${e.main_character.expPercent}%</span>`),$(".section-my-character.char-level .box .stat .bar").css("width",e.main_character.expPercent+"%"),$(".section-my-character.char-level .ranking .ranking-server dd").html(e.main_character.allRank),$(".section-my-character.char-level .ranking .ranking-class").html(`<dt>${e.main_character.className} 클래스 순위</dt><dd>${e.main_character.classRank}</dd>`),$(".hpmp-info .hp .var").html(`${e.main_character.maxhp} / ${e.main_character.maxhp}`),$(".hpmp-info .mp .var").html(`${e.main_character.maxmp} / ${e.main_character.maxmp}`),$("#stat-str").html(`<div class="graph"><span class="bar percent-${e.main_character.str<<1}"></span></div><span class="var">${e.main_character.str}</span>`),$("#stat-int").html(`<div class="graph"><span class="bar percent-${e.main_character.intel<<1}"></span></div><span class="var">${e.main_character.intel}</span>`),$("#stat-dex").html(`<div class="graph"><span class="bar percent-${e.main_character.dex<<1}"></span></div><span class="var">${e.main_character.dex}</span>`),$("#stat-wis").html(`<div class="graph"><span class="bar percent-${e.main_character.wis<<1}"></span></div><span class="var">${e.main_character.wis}</span>`),$("#stat-con").html(`<div class="graph"><span class="bar percent-${e.main_character.con<<1}"></span></div><span class="var">${e.main_character.con}</span>`),$("#stat-cha").html(`<div class="graph"><span class="bar percent-${e.main_character.cha<<1}"></span></div><span class="var">${e.main_character.cha}</span>`),$(".pk-info").html(`<dt>PK카운트</dt><dd>${e.main_character.pk}</dd><dt>성향</dt><dd>${e.main_character.lawful}</dd>`)}inventory(){let e=this;e.invenItem=inventory,e.normalWareItem=normal_warehouse,e.packageWareItem=package_warehouse,$("#inv-size").text(e.invenItem.length),$("#invs-size").text(e.invenItem.length),$("#normalware-size").text(e.normalWareItem.length),$("#packageware-size").text(e.packageWareItem.length),e.windowWidth=$(window).width(),e.sortor=$(".ui-dropdown.ui-dropdown-sort1"),e.selector=$(".ui-select-tab.select-tab-inventory"),e.invTaps=e.selector.find("li"),e.sortorTaps=e.sortor.find("li"),e.sortData=[],e.invParam={invType:"char",sortType:"ALL"},e.container=$(".pagination-container"),e.paginationRender=function(s){e.container.pagination({dataSource:s,pageSize:10,showPrevious:!1,showNext:!1,showPageNumbers:!0,callback:function(e,s){let t="";t=e.length?e.map((e,s)=>`<li><img src="/img/item/${e.item.icon_id}.png" alt="" onerror="this.src='https://cdn.jsdelivr.net/gh/pjs4020032303-coder/web/img/shop/noimg.gif'" class="thumb"><strong class="name${n(e.bless)}">${a(e.item.name,e.enchant,e.attr)} (${commaAdd(e.count)})</strong></li>`).join(""):`<div class="no-data"><p>아이템이 없습니다.</p></div>`,$(".item-list").html(`<ul>${t}</ul>`)}})},e.ATTR_DESC=["","화령:1단의 ","화령:2단의 ","화령:3단의 ","화령:4단의 ","화령:5단의 ","수령:1단의 ","수령:2단의 ","수령:3단의 ","수령:4단의 ","수령:5단의 ","풍령:1단의 ","풍령:2단의 ","풍령:3단의 ","풍령:4단의 ","풍령:5단의 ","지령:1단의 ","지령:2단의 ","지령:3단의 ","지령:4단의 ","지령:5단의 ",];let a=function(a,n,s){return n<0?e.ATTR_DESC[s]+n+" "+a:n>0?e.ATTR_DESC[s]+"+"+n+" "+a:e.ATTR_DESC[s]+a},n=function(e){switch(e){case 0:return" status-bless";case 2:return" status-curse";default:return""}};$(window).resize(function(){e.windowWidth=window.outerWidth,e.windowWidth<=960?e.selector.find(".select").hasClass("open")&&(e.selector.find(".select").removeClass("open"),e.selector.find(".select-tab.option").css("display","none")):e.selector.find(".select").hasClass("open")||(e.selector.find(".select").addClass("open"),e.selector.find(".select-tab.option").css("display","block"))}),e.selector.find(".select").on("click",function(){$(this).hasClass("open")?e.selectorClose():e.selectorOpen()}),e.selectorOpen=function(){e.selector.find(".select").addClass("open"),e.selector.find(".select-tab.option").css("display","block")},e.selectorClose=function(){e.selector.find(".select").removeClass("open"),e.selector.find(".select-tab.option").css("display","none")},e.invTaps.on("click",function(a){let n=$(this).attr("data-value");if(n!==e.invParam.invType){switch(e.invParam.invType=n,n){case"normal":e.paginationRender(e.normalWareItem);break;case"package":e.paginationRender(e.packageWareItem);break;default:e.paginationRender(e.invenItem)}e.invTaps.children("a").removeClass("selected"),$(this).children("a").addClass("selected"),e.selector.find(".select > span").html($(this).children("a").html()),e.windowWidth<=960&&e.selectorClose(),e.sortor.find(".select > span").text("전체"),e.invParam.sortType="ALL",e.sortorClose()}eventStop(a)}),e.sortorOpen=function(){e.sortor.find(".select").addClass("open"),e.sortor.find(".option").css("display","block")},e.sortorClose=function(){e.sortor.find(".select").removeClass("open"),e.sortor.find(".option").css("display","none")},e.sortor.find(".select").on("click",function(){$(this).hasClass("open")?e.sortorClose():e.sortorOpen()}),e.sortorTaps.on("click",function(a){let n=$(this).attr("data-value");n!==e.invParam.sortType&&(e.invParam.sortType=n,"ALL"!==n?(e.sortData.length=0,$.each("normal"===e.invParam.invType?e.normalWareItem:"package"===e.invParam.invType?e.packageWareItem:e.invenItem,function(a,s){switch(n){case"EQUIP":("WEAPON"===s.item.category||"ARMOR"===s.item.category)&&e.sortData.push(s);break;case"ETC":"NONE"===s.item.category&&e.sortData.push(s)}}),e.paginationRender(e.sortData)):e.paginationRender("normal"===e.invParam.invType?e.normalWareItem:"package"===e.invParam.invType?e.packageWareItem:e.invenItem),e.sortorTaps.removeClass("selected"),$(this).addClass("selected"),e.sortor.find(".select > span").html($(this).children("a").html())),e.sortorClose(),eventStop(a)}),e.windowWidth<=960?e.selectorClose():e.selectorOpen(),e.paginationRender(e.invenItem)}mail(){let e=this;e.mailPrivate=[],e.mailPledge=[],e.mailKeep=[],mails&&$.each(mails,function(a,n){switch(n.code){case 1:e.mailPledge.push(n);break;case 2:e.mailKeep.push(n);break;default:e.mailPrivate.push(n)}}),e.windowWidth=$(window).width(),e.selector=$(".ui-select-tab.select-tab-maillist"),e.mailTaps=e.selector.find("li"),e.mailParam={mailType:"NORMAL"},e.container=$(".pagination-container"),e.paginationRender=function(a){e.container.pagination({dataSource:a,pageSize:10,showPrevious:!1,showNext:!1,showPageNumbers:!0,callback:function(e,a){let n="";n=e.length?e.map((e,a)=>`<li><header><div class="subject ${e.isCheck?"":"new"}" onclick="$(this).parent().toggleClass('on').next().toggle();">${e.subject}</div><div class="info"><span class="from">${e.sender}</span> <span class="date">${moment(new Date(e.date)).format("YYYY-MM-DD")}</span></div></header><article>${e.content}</article></li>`).join(""):`<div class="no-data"><p>편지가 없습니다.</p></div>`,$(".normal-list").html(`<ul>${n}</ul>`)}})},$(window).resize(function(){e.windowWidth=window.outerWidth,e.windowWidth<=960?e.selector.find(".select").hasClass("open")&&(e.selector.find(".select").removeClass("open"),e.selector.find(".select-tab.option").css("display","none")):e.selector.find(".select").hasClass("open")||(e.selector.find(".select").addClass("open"),e.selector.find(".select-tab.option").css("display","block"))}),e.selector.find(".select").on("click",function(){$(this).hasClass("open")?e.selectorClose():e.selectorOpen()}),e.selectorOpen=function(){e.selector.find(".select").addClass("open"),e.selector.find(".select-tab.option").css("display","block")},e.selectorClose=function(){e.selector.find(".select").removeClass("open"),e.selector.find(".select-tab.option").css("display","none")},e.mailTaps.on("click",function(a){let n=$(this).attr("data-value");if(n!==e.mailParam.mailType){switch(e.mailParam.mailType=n,n){case"PLEDGE":e.paginationRender(e.mailPledge);break;case"STOREGE":e.paginationRender(e.mailKeep);break;default:e.paginationRender(e.mailPrivate)}e.mailTaps.children("a").removeClass("selected"),$(this).children("a").addClass("selected"),e.selector.find(".select > span").html($(this).children("a").html()),e.windowWidth<=960&&e.selectorClose()}eventStop(a)}),e.windowWidth<=960?e.selectorClose():e.selectorOpen(),e.paginationRender(e.mailPrivate)}board(){let e=this;includeHTML(document.querySelector("#svg-container"),"https://cdn.jsdelivr.net/gh/pjs4020032303-coder/web/svg.html",cacheVersion),e.boardParam={boardType:"board"},e.container=$(".pagination-container"),e.paginationRender=function(){e.container.pagination({dataSource:function(a){getDatasWithOption([{type:"POST",url:"/define/account/board",dataType:"json",contentType:"application/json",Accept:"application/json",data:e.boardParam}],e=>{a(e)},e=>{console.log("fail data board mypage.js")})},pageSize:10,showPrevious:!1,showNext:!1,showPageNumbers:!0,callback:function(e,n){var s="";e.length?($.each(e,function(e,n){s+=a(n)}),$(".ncCommunityBoardList").addClass("board-list-default")):(s="<li>등록된 글이 없습니다.</li>",$(".ncCommunityBoardList").addClass("board-list-none")),$(".ncCommunityBoardList").html(s),$(".nc-community-loader").css("display","none")}})};let a=function(e){let a=e.board.readcount?e.board.readcount:0,o=e.board.likenames&&e.board.likenames.length?e.board.likenames.length:0,l=e.board.answerList&&e.board.answerList.length?e.board.answerList.length:0,d=t(e);return`<li class="board-items"><div class="title"><span class="category">${e.boardType}</span><a href="${d}">${e.board.title}</a><div class="count">`+c(e.board)+i(e.board)+r(e.board)+'</div></div><div class="info">'+`<span class="writer">${n(e)}<span class="server">${serverName}</span></span>`+`<span class="date">${s(e)}</span>`+`<span class="hit"><em class="txt">조회</em>${a}</span>`+`<span class="like" data-count="3">추천<em>${o}</em></span>`+"</div>"+`<div class="comment"><a href="${d}"><span><em class="number">${l}</em><em class="txt">댓글</em></span></a></div>`+"</li>"},n=function(e){return"거래소"===e.boardType?e.board.sellerCharacter:e.board.name},s=function(e){return"거래소"===e.boardType?moment(new Date(e.board.writeTime)).format("YY.MM.DD."):moment(new Date(e.board.date)).format("YY.MM.DD.")},t=function(e){return`javascript:urlform('${e.board.rownum}', 'post', '${e.boardUrl}');`},i=function(e){return e.likenames&&e.likenames.length?`&nbsp;<span class="count-like"><svg class="fe-svg fe-svg-like_s"><use xlink:href="#fe-svg-like_s"></use></svg><em>${e.likenames.length}</em></span>`:""},r=function(e){return e.answerList&&e.answerList.length?`&nbsp;<span class="count-comment"><svg class="fe-svg fe-svg-comment"><use xlink:href="#fe-svg-comment"></use></svg><em>${e.answerList.length}</em></span>`:""},c=function(e){return e.mainImg?'&nbsp;<svg class="fe-svg fe-svg-picture"><use xlink:href="#fe-svg-picture"></use></svg>':""};$(".co-btn-top_list").on("click",function(e){$(window).scrollTop(0),e.preventDefault()}),e.paginationRender()}comment(){let e=this;includeHTML(document.querySelector("#svg-container"),"https://cdn.jsdelivr.net/gh/pjs4020032303-coder/web/svg.html",cacheVersion),e.boardParam={boardType:"comment"},e.container=$(".pagination-container"),e.paginationRender=function(){e.container.pagination({dataSource:function(a){getDatasWithOption([{type:"POST",url:"/define/account/board",dataType:"json",contentType:"application/json",Accept:"application/json",data:e.boardParam}],e=>{a(e)},e=>{console.log("fail data comment mypage.js")})},pageSize:10,showPrevious:!1,showNext:!1,showPageNumbers:!0,callback:function(e,n){let s="";e.length?($.each(e,function(e,n){s+=a(n)}),$(".ncCommunityBoardList").addClass("board-list-default")):(s="<li>등록된 글이 없습니다.</li>",$(".ncCommunityBoardList").addClass("board-list-none")),$(".ncCommunityBoardList").html(s),$(".nc-community-loader").css("display","none")}})};let a=function(e){let a=e.board.readcount?e.board.readcount:0,o=e.board.likenames&&e.board.likenames.length?e.board.likenames.length:0,l=e.board.answerList&&e.board.answerList.length?e.board.answerList.length:0,d=t(e);return`<li class="board-items"><div class="title"><span class="category">${e.boardType}</span><a href="${d}">${e.board.title}</a><div class="count">`+c(e.board)+i(e.board)+r(e.board)+'</div></div><div class="info">'+`<span class="writer">${n(e)}<span class="server">${serverName}</span></span>`+`<span class="date">${s(e)}</span>`+`<span class="hit"><em class="txt">조회</em>${a}</span>`+`<span class="like" data-count="3">추천<em>${o}</em></span>`+"</div>"+`<div class="comment"><a href="${d}"><span><em class="number">${l}</em><em class="txt">댓글</em></span></a></div>`+"</li>"},n=function(e){return e.board.name},s=function(e){return moment(new Date(e.board.date)).format("YY.MM.DD.")},t=function(e){return`javascript:urlform('${e.board.rownum}', 'post', '${e.boardUrl}');`},i=function(e){return e.likenames&&e.likenames.length?`&nbsp;<span class="count-like"><svg class="fe-svg fe-svg-like_s"><use xlink:href="#fe-svg-like_s"></use></svg><em>${e.likenames.length}</em></span>`:""},r=function(e){return e.answerList&&e.answerList.length?`&nbsp;<span class="count-comment"><svg class="fe-svg fe-svg-comment"><use xlink:href="#fe-svg-comment"></use></svg><em>${e.answerList.length}</em></span>`:""},c=function(e){return e.mainImg?'&nbsp;<svg class="fe-svg fe-svg-picture"><use xlink:href="#fe-svg-picture"></use></svg>':""};$(".co-btn-top_list").on("click",function(e){$(window).scrollTop(0),e.preventDefault()}),e.paginationRender()}addEvents(){let e=this;e.signature_btn=$(".ui-signature .btn"),e.character_list=$(".my-character-list"),e.my_character_list=$(".my-character-list .list .items"),e.character_list_close_btn=$(".my-character-list .btn-close"),e.myTaps=$("#mypageTab li"),e.signature_btn.on("click",function(a){$(this).hasClass("open")?($(this).removeClass("open"),e.character_list.hide()):($(this).parent().next().show().addClass("show"),e.signature_btn.addClass("open"))}),e.character_list_close_btn.on("click",function(a){$(this).parent().removeClass("show").hide(),e.signature_btn.removeClass("open")}),e.my_character_list.on("click",function(a){if($(this).find(".name").text()==$(".ncc-login--info__char").text())return e.signature_btn.removeClass("open"),e.character_list.hide(),!1;let n=$(this).attr("data-id");if(!n||!header_main||!header_main._login||!header_main._login._right)return!1;header_main._login._right.mainCharacterChange(n)}),e.myTaps.on("click",function(e){let a=$(this).children("a").attr("data-type");tabType!=a&&urlTypeform(a,null,"post","/account/mypage"),eventStop(e)})}}Mypage.instance;