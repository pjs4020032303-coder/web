/*!
 * project : ranking
 * author : LINOFFICE
 * 랭킹
 */ let rank_singleton=null,rank_singletonEnforcer="singletonEnforcer";class Ranking{constructor(a){if(a!==rank_singletonEnforcer)throw"Cannot--construct singleton";this.init()}static get instance(){return rank_singleton||(rank_singleton=new Ranking(rank_singletonEnforcer)),rank_singleton}init(){let a=this;a.parmaeter={charType:"all"},a.GAME_CLASS_NAME=["군주","기사","요정","마법사","다크엘프","용기사","환술사","전사","검사","창기사","성기사","투사"],a.wrap=$(".table-ranking-area"),a.wrap_list=$(".table-list"),a.container=$(".pagination"),a.loader=$(".data-loader"),a.my_char_rank=null,a.setMyCharacterRanking(),a.setClassRanking(),a.addEvents()}setMyCharacterRanking(){let a=this;if(!account||!account.charList)return;let s=account.charList.map((s,n)=>s.level<80||0===s.allRank?"":`<div class="detail-info-list"><dl><dt class="thumb"><img src="https://cdn.jsdelivr.net/gh/pjs4020032303-coder/web${s.profileUrl}"></dt><dd><strong class="name">${s.name}</strong><span class="server">${serverName}</span><span class="level">${s.level}Lv.</span></dd></dl><div class="ranking-info"><ul><li><strong>${s.allRank}</strong><span>서버랭킹</span></li><li><strong>${s.classRank}</strong><span>클래스랭킹</span></li><li class="grade"><span class="star ${a.getGradeMy(s.allRank)}"></span><span>등급</span></li></ul></div></div>`).join("");s&&($(".section-ranking-mycharacter").append(`<div class="wrap-detail-info" style="display: block;"><h2><strong>내캐릭터</strong><span class="date">${rank_cache_time}</span></h2><div class="detail-info">${s}</div><p class="notice">* 80레벨 이상 캐릭터만 랭킹 확인이 가능합니다.</p></div>`),a.my_char_rank=$(".section-ranking-mycharacter .detail-info"),a.my_char_rank.slick({dots:!0,arrows:!1,infinite:!0,speed:250,slidesToShow:1,slidesToScroll:1,responsive:[{breakpoint:Number.MAX_VALUE,settings:"unslick"},{breakpoint:960,settings:{slidesToShow:1,slidesToScroll:1}}]}))}setClassRanking(){let a=this;a.loader.css("display","block"),a.container.pagination({dataSource:function(s){getDatasWithOption([{type:"POST",url:"/define/rank",dataType:"json",contentType:"application/json",Accept:"application/json",data:a.parmaeter}],a=>{s(a)},s=>{throw a.loader.css("display","none"),$(".nodata").remove(),a.wrap_list.css("display","none"),$(".section-ranking-list").append(`<div class="nodata"><p>랭킹 정보를 제공하지 않는 서버입니다.</p></div>`),Error("render from rank.js Error")})},pageSize:20,showPrevious:!1,showNext:!1,showPageNumbers:!0,callback:function(s,n){let e="";$(".nodata").remove(),s.length?(e=s.map((s,n)=>{let e=s.curRank-s.oldRank,t=a.GAME_CLASS_NAME[s.classId],i=a.getGrade("all"===a.parmaeter.charType?s.curRank:s.subCurRank);return`<tr><td class="rank"><span class="num">${s.curRank}</span><span class="ui-rank ${e>0?"up":e<0?"down":""}">${0==e?"-":e}</span></td><td>${s.name}</td><td>${t}</td><td class="grade"><span class="star ${i}"></span></td></tr>`}).join(""),a.wrap_list.css("display","block")):(a.wrap_list.css("display","none"),$(".section-ranking-list").append(`<div class="nodata"><p>랭킹 정보가 없습니다.</p></div>`)),a.wrap.html(e),a.loader.css("display","none")}})}getGradeMy(a){return a>=1&&a<=10?"grade4":a>=11&&a<=20?"grade3":a>=21&&a<=30?"grade2":a>=31&&a<=50?"grade1":"grade0"}getGrade(a){return 1==a?"top1":2==a?"top2":3==a?"top3":a>=4&&a<=10?"grade4":a>=11&&a<=20?"grade3":a>=21&&a<=30?"grade2":a>=31&&a<=50?"grade1":"grade0"}resize(){this.my_char_rank&&this.my_char_rank.slick("resize")}addEvents(){let a=this,s=$(window).width(),n=$(".ui-select-tab.select-tab-class"),e=$(".select-tab.option > li > a");$(window).resize(function(){let e=window.outerWidth;s=e,e<=960?n.find(".select").hasClass("open")&&(n.find(".select").removeClass("open"),n.find(".select-tab.option").css("display","none"),a.resize()):n.find(".select").hasClass("open")||(n.find(".select").addClass("open"),n.find(".select-tab.option").css("display","block"),a.resize())}),e.on("click",function(t){let l=$(this).attr("data-type");if(a.parmaeter.charType===l){s<=960&&n.find(".select").hasClass("open")&&i(),eventStop(t);return}a.parmaeter.charType=l,e.removeClass("selected"),$(this).addClass("selected"),$("#rankingtop").text("all"===l?rank_total_range:rank_class_range),n.find(".select").text($(this).text()),a.container.destory,a.setClassRanking(),s<=960&&n.find(".select").hasClass("open")&&i(),eventStop(t)}),n.find(".select").on("click",function(){$(this).hasClass("open")?i():t()});let t=function(){n.find(".select").addClass("open"),n.find(".select-tab.option").css("display","block")},i=function(){n.find(".select").removeClass("open"),n.find(".select-tab.option").css("display","none")};$("body").mouseup(function(a){!(s<=960)||n.has(a.target).length||e.has(a.target).length||i(),eventStop(a)}),s<=960?i():t()}}Ranking.instance;