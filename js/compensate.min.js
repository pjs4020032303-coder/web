/*!
 * project : compensate
 * author : LINOFFICE
 * 보상 안내
 */ let purchase_container=[];function purchase_all_select(){let a=$("#purchase_list .purchase_item");a&&("전체선택"===$("#all_select").text()?($("#all_select").text("전체해제"),$.each(a,function(a,s){let e=$(s).find(".item_check"),c=e.prop("checked");if(!c){let p=$(s).attr("data-id"),l=Number($(s).attr("data-price")),n=Number(commaRemove($("#expected_ncoin em").text()));e.prop("checked",!0);for(var t=0;t<purchaseItems.length;t++)if(purchaseItems[t].itemObjectId==p){purchase_container.push(purchaseItems[t]);break}$("#expected_ncoin em").text(commaAdd(n+l)),$(s).addClass("on")}})):($("#all_select").text("전체선택"),$.each(a,function(a,s){let e=$(s).find(".item_check"),c=e.prop("checked");if(c){let p=$(s).attr("data-id"),l=Number($(s).attr("data-price")),n=Number(commaRemove($("#expected_ncoin em").text()));e.prop("checked",!1);for(var t=0;t<purchase_container.length;t++)if(purchase_container[t].itemObjectId==p){purchase_container.splice(t,1);break}$("#expected_ncoin em").text(commaAdd(n-l)),$(s).removeClass("on")}})))}function show_purchaseItems(){let a=purchaseItems.map((a,s)=>`<li class="purchase_item" data-id="${a.itemObjectId}" data-enchant="${a.enchant}" data-elemental="${a.elemental}" data-bless="${a.bless}" data-price="${a.price}"><div class="left_div"><img src="/img/item/${a.icon}.png"><span class="desc">${a.descryption}</span><span class="price">${commaAdd(a.price)}</span></div><input type="checkbox" class="item_check" disabled></li>`).join("");$(".current_status").prepend(`<div id="purchase_container"><div class="top"><span class="top_title">매입 가능 보유 아이템 ${purchaseItems.length} 개</span><button id="all_select" onClick="purchase_all_select();">전체선택</button></div><div id="purchase_list" class="scrollbar-macosx"><ul>${a}</ul></div><div class="bottom"><div id="purchase_btn"><button onClick="purchase_confirm();">매입하기</button></div><div id="expected_ncoin">매입 예상 총 금액<em>0</em></div></div></div>`)}$(function(){$(".wrap_contents_support .ncoin_status .ncoin").text(account?commaAdd(account.ncoin):"로그인 후 확인할 수 있습니다."),purchaseItems&&purchaseItems.length&&show_purchaseItems();let a=$(".pur_item_list_info");$(".pur_item_list button.list_show").on("click",function(s){a.hasClass("on")?a.removeClass("on"):a.addClass("on")}),$(".pur_item_list button.list_close").on("click",function(s){a.removeClass("on")}),$("#purchase_list .purchase_item").on("click",function(a){let s=$(this).find(".item_check"),e=s.prop("checked"),c=$(this).attr("data-id"),p=Number($(this).attr("data-price")),l=Number(commaRemove($("#expected_ncoin em").text()));if(e){s.prop("checked",!1);for(var n=0;n<purchase_container.length;n++)if(purchase_container[n].itemObjectId==c){purchase_container.splice(n,1);break}$("#expected_ncoin em").text(commaAdd(l-p)),$(this).removeClass("on")}else{s.prop("checked",!0);for(var n=0;n<purchaseItems.length;n++)if(purchaseItems[n].itemObjectId==c){purchase_container.push(purchaseItems[n]);break}$("#expected_ncoin em").text(commaAdd(l+p)),$(this).addClass("on")}}),$(".scrollbar-macosx").scrollbar()});var purchaseLock=!1;function purchase_item(){if(purchaseLock)return;let a="";for(var s=0;s<purchase_container.length;s++)s>0&&(a+="|"),a+=purchase_container[s].itemObjectId;purchaseLock=!0,$(".dimmed").css("display","block"),$("#send_delay").css("display","block");let e={select_items:a};getDatasWithOption([{type:"POST",url:"/define/compensate/purchase",dataType:"json",contentType:"application/json",Accept:"application/json",data:e}],a=>{switch($("#send_delay").css("display","none"),a){case 1:popupShow("정상적으로 완료되었습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 2:popupShow("인게임에서 이용할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 3:popupShow("계정을 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 4:popupShow("대표 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 5:popupShow("월드 내 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 6:popupShow("매입 가능 보유 아이템을 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 7:popupShow("선택한 아이템 정보를 전달하지 못하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 8:popupShow("선택한 아이템을 파싱하지 못하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 9:popupShow("인벤토리에서 아이템을 발견하지 못하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 10:popupShow("지금은 이용할 수 있는 기간이 아닙니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;default:popupShow("매입에 실패하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null)}purchaseLock=!1},a=>{purchaseLock=!1,$(".dimmed").css("display","none"),$("#send_delay").css("display","none")})}function purchase_confirm(){if(!account){popupShow("로그인 후 이용할 수 있습니다..",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}if(!account.firstChar){popupShow("대표 캐릭터가 설정되어 있지 않습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}if(!purchase_container||!purchase_container.length){popupShow("매입시킬 아이템을 선택하십시오.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}popupShow("정말로 매입 시키겠습니까?",'<span class="type2"><a href="javascript:purchase_item();" class="close">예</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>')}var changeLock=!1;function couponChange(){if(changeLock)return;let a="";if($("#to_mail")&&$("#to_mail").val()){if(!is_email_check($("#to_mail").val())){popupShow("이메일이 올바르지 않습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}a=$("#to_mail").val()}else a="";let s={to_email:a};$(".dimmed").css("display","block"),$("#send_delay").css("display","block"),changeLock=!0,getDatasWithOption([{type:"POST",url:"/define/compensate",dataType:"json",contentType:"application/json",Accept:"application/json",data:s}],a=>{switch(a.code){case 1:popupShow("발급 쿠폰 번호\r\n"+a.number,'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null),$(".create_number").html(`<div class="coupon_number"><strong>발급 쿠폰 번호 : </strong><strong>${a.number}</strong></div>`),account.ncoin=0,$(".wrap_contents_support .ncoin_status .ncoin").text("0");break;case 2:popupShow("계정을 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 3:popupShow("보유중인 NCOIN이 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 4:popupShow("메일 전송에 실패하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 5:popupShow("지금은 이용할 수 있는 기간이 아닙니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;default:popupShow("등록에 실패하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null)}changeLock=!1,$(".dimmed").css("display","none"),$("#send_delay").css("display","none")},a=>{changeLock=!1,$(".dimmed").css("display","none"),$("#send_delay").css("display","none")})}function change_confirm(){if(!account){popupShow("로그인 후 이용할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}if(!account.ncoin){popupShow("보유중인 NCOIN이 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}if(purchaseItems&&purchaseItems.length){popupShow("매입할 아이템이 존재합니다.<br>바로 환전 하시겠습니까?",'<span class="type2"><a href="javascript:couponChange();" class="close">예</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>');return}popupShow("정말로 환전 하시겠습니까?",'<span class="type2"><a href="javascript:couponChange();" class="close">예</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>')}