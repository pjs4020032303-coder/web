/*!
 * project : trade_ncoin_regist
 * author : LINOFFICE
 * 거래소(N코인) 상품 등록
 */ let select_item,select_amount,select_price;function get_item(s){return inventory_items?inventory_items.find(e=>e.id==s):null}function init_progress(){let s='<section class="init_section">';s+=`<div class="message_area"><h1>상품 등록 안내</h1><ul>${regist_message}</ul></div>`,s+=`<div class="btn_wrap"><button type="button" class="btn" onClick="select_progress();"><span>다음</span></button></div>`,s+="</section>",$(".regist_container").html(s)}$(function(){includeHTML(document.querySelector("#svg-container"),"https://cdn.jsdelivr.net/gh/pjs4020032303-coder/web/svg.html",cacheVersion),init_progress()});const BLESS_FLAG=["bless","","curse",],ELEMENT_DESC=["","화령 1단 ","화령 2단 ","화령 3단 ","화령 4단 ","화령 5단 ","수령 1단 ","수령 2단 ","수령 3단 ","수령 4단 ","수령 5단 ","풍령 1단 ","풍령 2단 ","풍령 3단 ","풍령 4단 ","풍령 5단 ","지령 1단 ","지령 2단 ","지령 3단 ","지령 4단 ","지령 5단 "];function get_item_name(s){let e='<span class="'+BLESS_FLAG[s.bless]+'">';return e+=ELEMENT_DESC[s.element],0!=s.enchant&&(s.enchant>0?e+="+"+s.enchant+" ":e+="-"+s.enchant+" "),e+=s.desc,e+=" ("+commaAdd(s.count)+")",s.potential_id>0&&(e+=" "+s.potential_desc),e+="</span>"}function select_progress(){if(!inventory_items||!inventory_items.length){popupShow("등록 가능한 아이템이 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}let s="";$.each(inventory_items,function(e,t){s+=`<li><img src="/img/item/${t.icon}.png" alt=""><label for="item${t.id}">${get_item_name(t)}</label><input type="radio" name="select_item" id="item${t.id}" value="${t.id}"><div class="wrap-icon"><svg class="fe-svg fe-svg-check_off"><use xlink:href="#fe-svg-check_off"></use></svg><svg class="fe-svg fe-svg-check_on"><use xlink:href="#fe-svg-check_on"></use></svg></div></li>`}),select_item=void 0;let e='<section class="select_section">';e+=`<div class="message_area"><p>등록할 상품을 선택하십시오.</p></div>`,e+=`<div class="inv_area"><ul>${s}</ul><div class="bottom_blank"></div></div>`,e+=`<div class="btn_wrap"><button type="button" class="btn left" onClick="init_progress();"><span>이전</span></button><button type="button" class="btn right" onClick="setting_progress();"><span>다음</span></button></div>`,e+="</section>",$(".regist_container").html(e)}function setting_progress(){if(!select_item){var s=$("input:radio[name=select_item]:checked").val();if(!s||!(select_item=get_item(s))){popupShow("아이템이 선택되지 않았습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}}select_amount=select_price=void 0;let e='<section class="setting_section">';e+=`<div class="message_area"><p>수량 및 가격을 설정하십시오.</p></div>`,e+='<div class="input_area">',e+=`<div class="input_box"><label>판매 수량</label><input type="text" autocomplete="off" placeholder="수량을 입력해주세요" id="reg_amount" maxlength="10"></div>`,e+=`<div class="input_box"><label>판매 가격</label><input type="text" autocomplete="off" placeholder="금액을 입력해주세요" id="reg_price" maxlength="10"></div>`,e+="</div>",e+=`<div class="btn_wrap"><button type="button" class="btn left" onClick="select_progress();"><span>이전</span></button><button type="button" class="btn right" onClick="finish_progress();"><span>다음</span></button></div>`,e+="</section>",$(".regist_container").html(e),setInputToComma($("#reg_amount")),setInputToComma($("#reg_price"))}function get_finish_item_desc(s){let e=`<span class="${BLESS_FLAG[s.bless]}">`;return e+=ELEMENT_DESC[s.element],0!=s.enchant&&(e+=s.enchant>0?`+${s.enchant} `:`-${s.enchant} `),0==s.bless?e+=`축복받은 `:2==s.bless&&(e+=`저주받은 `),e+=s.desc,s.potential_id>0&&(e+=` [${s.potential_desc}]`),e+="</span>"}function finish_progress(){if(!select_item){popupShow("아이템이 선택되지 않았습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}let s=$("#reg_amount").val(),e=Number(commaRemove(s));if(!s||e<=0){popupShow("수량이 설정되지 않았습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}let t=$("#reg_price").val(),a=Number(commaRemove(t));if(!t||a<=0){popupShow("가격이 설정되지 않았습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}if(a<1e3){popupShow("최소 등록 금액은 1,000코인 입니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}if(a%1e3!=0){popupShow("1,000코인 단위로 등록할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}select_amount=e,select_price=a;let n='<section class="finish_section">';n+=`<div class="message_area"><p>등록하실 아이템을 확인 후 등록 버튼을 눌러주세요.</p><p>등록완료 즉시 인벤토리에서 회수됩니다.</p></div>`,n+='<div class="finish_area">',n+=`<div class="icon"><img src="/img/item/${select_item.icon}.png" alt=""></div>`,n+=`<div class="desc txt">아이템: ${get_finish_item_desc(select_item)}</div>`,n+=`<div class="amount txt">판매개수: <span>${s}개</span></div>`,n+=`<div class="coin_area txt">판매가격: <span class="ncoin">${t}</span></div>`,n+=`<div class="seller_name txt">판매자: <span>${account.firstChar.name}</span></div>`,n+="</div>",n+=`<div class="btn_wrap"><button type="button" class="btn left" onClick="setting_progress();"><span>이전</span></button><button type="button" class="btn right" onClick="regist();"><span>등록</span></button></div>`,n+="</section>",$(".regist_container").html(n)}function onKeyupAmount(s){inputCheckNumber(s);var e=Number(commaRemove($(s).val()));e&&e>select_item.count&&$(s).val(commaAdd(select_item.count))}function onKeyupPrice(s){inputCheckNumber(s)}function finish_regist(){popupClose(),window.self.opener?(window.opener.location.reload(),window.self.close()):history.back()}let regist_lock=!1;function regist(){if(regist_lock)return;let s={id:select_item.id,amount:select_amount,price:select_price};regist_lock=!0,getDatasWithOption([{type:"POST",url:"/define/trade_ncoin/regist",dataType:"json",contentType:"application/json",Accept:"application/json",data:s}],s=>{switch(s){case 1:popupShow("정상적으로 등록되었습니다.",'<span class="type2"><a href="javascript:finish_regist();" class="close">닫기</a></span>',null);break;case 2:popupShow("인게임에서 등록할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 3:popupShow("계정 정보를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 4:popupShow("대표 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 5:popupShow("월드 내 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 6:popupShow("인벤토리에 아이템이 존재하지 않습니다. ",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 7:popupShow("보유중인 수량이 판매할 수량보다 적습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 9:popupShow("고객님께서는 이용제한 상태입니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;default:popupShow("등록에 실패하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null)}regist_lock=!1},s=>{regist_lock=!1})}