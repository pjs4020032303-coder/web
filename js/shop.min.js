/*!
 * project : shop
 * author : LINOFFICE
 * 시세
 */ let shop_singleton=null,shop_singletonEnforcer="singletonEnforcer";class Shop{constructor(e){if(e!==shop_singletonEnforcer)throw"Cannot--construct singleton";this.init()}static get instance(){return shop_singleton||(shop_singleton=new Shop(shop_singletonEnforcer)),shop_singleton}init(){let e=this;e.data_loader=$(".data-loader"),searchRealtimeKeyword({wrap:$(".section-keyword"),service:"item",pos:"popkwd"}),create_auto_suggest({selector:"#suggestForm",size:5,action:"/my/item-search",type:"1",useDelbtn:!0})}rank(){let e=this;e.container=$(".searchrank-article"),e.item=$(".searchrank-nav .nav-item"),e.item_tap=$(".searchrank-nav .nav-item > a"),e.item_header=$("header .searchrank-nav .nav-item"),e.item_footer=$("footer .searchrank-nav .nav-item"),e.container.slick({dots:!1,arrows:!1,infinite:!0,slidesToShow:1,slidesToScroll:1}),e.item_tap.on("click",function(s){e.container.slick("slickGoTo",$(this).attr("data-slide")-1)}),e.container.on("beforeChange",function(s,a,t,n){e.item.removeClass("on"),e.item_header.eq(n).addClass("on"),e.item_footer.eq(n).addClass("on")})}search(){let e=this;e.container=$(".pagination-container"),e.container.pagination({dataSource:function(e){getDatasWithOption([{type:"POST",url:"/define/item-search/list",dataType:"json",contentType:"application/json",Accept:"application/json",data:{keyword:searchKeyword}}],s=>{s&&s.length?$(".search-util__result .count").text(commaAdd(s.length)):($(".search-util").css("display","none"),$(".section-search-help").css("display","none")),e(s)},e=>{console.log("fail api data from shop.js")})},pageSize:10,showPrevious:!1,showNext:!1,showPageNumbers:!0,callback:function(s,a){let t="";t=s.length?`<ul>${s.map((e,s)=>`<li><div class="item-name"><div class="server">${serverName}</div><a href="/my/item-search/view?itemId=${encodeURIComponent(e.name)}&enchant=${e.enchant}"><div class="thumbnail"><img src="/img/item/${e.iconId}.png" onerror="this.onerror=null; this.src='https://cdn.jsdelivr.net/gh/pjs4020032303-coder/web/img/shop/noimg.gif' class="thumb" alt="${e.name}"></div><h2 class="name">${e.enchant>0?`+${e.enchant} `:""}${e.name}</h2></a></div><div class="item-price item-price--sell"><h3>판매가격</h3><ul>`+(e.sellTotalCount>0?`<li><a href="/my/item-search/view?itemId=${encodeURIComponent(e.name)}&enchant=${e.enchant}&tradeType=SELL&bless=ALL"><span class="category">전체</span><span class="price">${e.sellTotalPriceInfo}</span> <span class="count">(${commaAdd(e.sellTotalCount)})</span></a></li>`:"")+(e.sellNormalCount>0?`<li><a href="/my/item-search/view?itemId=${encodeURIComponent(e.name)}&enchant=${e.enchant}&tradeType=SELL&bless=NORMAL"><span class="category">일반</span><span class="price">${e.sellNormalPriceInfo}</span> <span class="count">(${commaAdd(e.sellNormalCount)})</span></a></li>`:"")+(e.sellBlessCount>0?`<li><a href="/my/item-search/view?itemId=${encodeURIComponent(e.name)}&enchant=${e.enchant}&tradeType=SELL&bless=BLESS"><span class="category">축복</span><span class="price">${e.sellBlessPriceInfo}</span> <span class="count">(${commaAdd(e.sellBlessCount)})</span></a></li>`:"")+(e.sellCurseCount>0?`<li><a href="/my/item-search/view?itemId=${encodeURIComponent(e.name)}&enchant=${e.enchant}&tradeType=SELL&bless=CURSE"><span class="category">저주</span><span class="price">${e.sellCursePriceInfo}</span> <span class="count">(${commaAdd(e.sellCurseCount)})</span></a></li>`:"")+(e.sellTotalCount<=0||e.sellNormalCount<=0||e.sellBlessCount<=0||e.sellCurseCount<=0?`<li class="nodata">${e.sellTotalCount<=0?`<span class="category">전체</span>`:""}${e.sellNormalCount<=0?`<span class="category">일반</span>`:""}${e.sellBlessCount<=0?`<span class="category">축복</span>`:""}${e.sellCurseCount<=0?`<span class="category">저주</span>`:""} 정보 없음</li>`:"")+'</ul></div><div class="item-price item-price--buy">'+`<h3>구매가격</h3>`+"<ul>"+(e.buyTotalCount>0?`<li><a href="/my/item-search/view?itemId=${encodeURIComponent(e.name)}&enchant=${e.enchant}&tradeType=BUY&bless=ALL"><span class="category">전체</span><span class="price">${e.buyTotalPriceInfo}</span> <span class="count">(${commaAdd(e.buyTotalCount)})</span></a></li>`:"")+(e.buyNormalCount>0?`<li><a href="/my/item-search/view?itemId=${encodeURIComponent(e.name)}&enchant=${e.enchant}&tradeType=BUY&bless=NORMAL"><span class="category">일반</span><span class="price">${e.buyNormalPriceInfo}</span> <span class="count">(${commaAdd(e.buyNormalCount)})</span></a></li>`:"")+(e.buyBlessCount>0?`<li><a href="/my/item-search/view?itemId=${encodeURIComponent(e.name)}&enchant=${e.enchant}&tradeType=BUY&bless=BLESS"><span class="category">축복</span><span class="price">${e.buyBlessPriceInfo}</span> <span class="count">(${commaAdd(e.buyBlessCount)})</span></a></li>`:"")+(e.buyCurseCount>0?`<li><a href="/my/item-search/view?itemId=${encodeURIComponent(e.name)}&enchant=${e.enchant}&tradeType=BUY&bless=CURSE"><span class="category">저주</span><span class="price">${e.buyCursePriceInfo}</span> <span class="count">(${commaAdd(e.buyCurseCount)})</span></a></li>`:"")+(e.buyTotalCount<=0||e.buyNormalCount<=0||e.buyBlessCount<=0||e.buyCurseCount<=0?`<li class="nodata">${e.buyTotalCount<=0?`<span class="category">전체</span>`:""}${e.buyNormalCount<=0?`<span class="category">일반</span>`:""}${e.buyBlessCount<=0?`<span class="category">축복</span>`:""}${e.buyCurseCount<=0?`<span class="category">저주</span>`:""} 정보 없음</li>`:"")+"</ul></div></li>").join("")}</ul>`:`<div class="search-article__nodata"><div class="nodata"><strong>검색 결과가 없습니다.</strong><ol><li>검색어의 철자가 정확한지 확인해주세요.</li><li>검색어가 두 단어 이상일 경우, 띄어쓰기를 확인해주세요.</li></ol></div></div>`,$(".search-article--item").html(t),e.data_loader.css("display","none")}}),e.search_icon=$(".search-util__result .icon"),e.search_help=$(".search-help"),e.search_close=$(".icon-close"),e.search_icon.on("click",function(s){e.search_help.css({display:"block"})}),e.search_close.on("click",function(s){e.search_help.css({display:"none"})}),$("body").mouseup(function(s){e.search_help.has(s.target).length||e.search_help.css({display:"none"})})}view(){let e=this;"SELL"===TRADE_TYPE?($("#tab_sell").addClass("active"),$(".item-price > .price").addClass("price-sell")):"BUY"===TRADE_TYPE&&($("#tab_buy").addClass("active"),$(".item-price > .price").addClass("price-buy")),e.ATTR_NAME=["없음","화령 1단","화령 2단","화령 3단","화령 4단","화령 5단","수령 1단","수령 2단","수령 3단","수령 4단","수령 5단","풍령 1단","풍령 2단","풍령 3단","풍령 4단","풍령 5단","지령 1단","지령 2단","지령 3단","지령 4단","지령 5단"],e.parameter={itemId:searchItemId,enchant:enchant,bless:bless,attr:searchAttr,tradeType:TRADE_TYPE},e.container=$(".pagination-container"),e.paginationRender=function(){e.data_loader.css("display","block"),e.container.pagination({dataSource:function(s){getDatasWithOption([{type:"POST",url:"/define/item-search/view-list",dataType:"json",contentType:"application/json",Accept:"application/json",data:e.parameter}],e=>{if(e){$(".search-util__result .count").text(e.length),$(".thumbnail").html(`<img src="/img/item/${e.iconId}.png" onerror="this.src='https://cdn.jsdelivr.net/gh/pjs4020032303-coder/web/img/shop/noimg.gif'" class="thumb" alt="">`);let a=[],t=$(".price > .price-now");if("SELL"===TRADE_TYPE){if(e.sellList){for(var n,i=0,l=0;l<e.sellList.length;l++)i+=e.sellList[l].itemObjList.length;let r=commaAdd(i);$(".section-history .header").html(`판매 가격 현황 <em class="count">${r}</em>건`),t.find("h3").text("현재 판매가격"),t.find(".price-store em").text(r),t.find(".price-qty dfn").text("총 판매수량 :"),t.find(".price-qty em").text(commaAdd(e.sellTotalCount)),e&&e.sellTotalPriceArray&&e.sellTotalPriceArray.length?(t.find(".price-min em").text(e.sellTotalPriceArray[0]),t.find(".price-max em").text(2===e.sellTotalPriceArray.length?e.sellTotalPriceArray[1]:e.sellTotalPriceArray[0])):(t.find(".price-min em").text(0),t.find(".price-max em").text(0));for(var l=0;l<e.sellList.length;l++)for(var c=0;c<e.sellList[l].itemObjList.length;c++)n=e.sellList[l].itemObjList[c],a.push([{bless:e.sellList[l].bless},n])}}else if(e.buyList){for(var n,o=0,l=0;l<e.buyList.length;l++)o+=e.buyList[l].itemObjList.length;let p=commaAdd(o);$(".section-history .header").html(`구매 가격 현황 <em class="count">${p}</em>건`),t.find("h3").text("현재 구매가격"),t.find(".price-store em").text(p),t.find(".price-qty dfn").text("총 구매수량 :"),t.find(".price-qty em").text(commaAdd(e.buyTotalCount)),e&&e.buyTotalPriceArray&&e.buyTotalPriceArray.length?(t.find(".price-min em").text(e.buyTotalPriceArray[0]),t.find(".price-max em").text(2===e.buyTotalPriceArray.length?e.buyTotalPriceArray[1]:e.buyTotalPriceArray[0])):(t.find(".price-min em").text(0),t.find(".price-max em").text(0));for(var l=0;l<e.buyList.length;l++)for(var c=0;c<e.buyList[l].itemObjList.length;c++)n=e.buyList[l].itemObjList[c],a.push([{bless:e.buyList[l].bless},n])}a.sort(function(e,s){return e[1].price-s[1].price}),s(a)}},e=>{console.log("fail api data from shop.js")})},pageSize:10,showPrevious:!1,showNext:!1,showPageNumbers:!0,callback:function(s,a){let t="";t=s.length?s.map((s,a)=>{let t=s[1].potential_grade,n;return`<div class="tr"><div class="td-row"><span class="td-enchant">${t||(s[1].enchant>0?`+${s[1].enchant}`:"-")}</span><span class="td-qty">${s[1].count}개</span><span class="td-price">${e.price_name(s[1].price)}</span></div><div class="td-row"><span class="td-status">${1==s[0].bless?`일반`:2==s[0].bless?`저주`:`축복`}</span><span class="td-attribute">${s[1].potential_desc||e.ATTR_NAME[s[1].attr]}</span><span class="td-store">${isIngame?`<a href="javascript:L1.FindMerchant('${s[1].charName}');">${s[1].charName} (${s[1].loc})</a>`:`${s[1].charName} (${s[1].loc})`}</span></div></div>`}).join(""):`<div class="nodata"><p>게임 내 개설 중인 상점이 없습니다.</p></div>`,$(".tbody").html(t),e.data_loader.css("display","none")}})};let s=$(".select"),a=$(".ui-dropdown");s.click(function(){let e=$(this).closest(".ui-dropdown");e.hasClass("is-active")?a.removeClass("is-active"):(a.removeClass("is-active"),e.addClass("is-active"))}),$("body").mouseup(function(e){!s.has(e.target).length&&!a.has(e.target).length&&a.hasClass("is-active")&&a.removeClass("is-active"),eventStop(e)});let t=$(".option > li");if(t.click(function(){let s=$(this).closest(".ui-dropdown");if(!$(this).hasClass("selected")){let a=$(this).text();if(a!==s.find("span").text()){let t=$(this).attr("data-value");s.find("span").text(a),$(this).closest(".option").children("li").removeClass("selected"),$(this).addClass("selected"),s.hasClass("dropdown-enchant")?e.parameter.enchant=t:s.hasClass("dropdown-status")?e.parameter.bless=t:s.hasClass("dropdown-attribute")&&(e.parameter.attr=t),e.container.destory,e.paginationRender()}}s.removeClass("is-active")}),enchant>0){$(".dropdown-enchant span").text("+"+enchant);let n=$(".dropdown-enchant .option li");n.removeClass("selected"),n.eq(enchant+1).addClass("selected")}if("ALL"!==bless){$(".dropdown-status span").text("NORMAL"===bless?"일반":"BLESS"===bless?"축복":"저주");let i=$(".dropdown-status .option li");i.removeClass("selected"),i.eq("NORMAL"===bless?1:"BLESS"===bless?2:3).addClass("selected")}e.paginationRender()}price_name(e){if(e<=0)return"0";let s="";if(e>1e8){let a=parseInt(e/1e8);e-=1e8*a,s+=`${commaAdd(a)}억`}if(e>1e4){let t=parseInt(e/1e4);e-=1e4*t,s+=` ${commaAdd(t)}만`}return e>0&&(s+=` ${commaAdd(e)}`),s}}