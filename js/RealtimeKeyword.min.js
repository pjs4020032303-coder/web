/*!
 * project : RealtimeKeyword
 * author : LINOFFICE
 * 실시간 키워드
 */ class RealtimeKeyword{constructor(e){let t=this;if(!e)return;t.INTERVAL_ROLLING_ITEMS=3500,t.option=$.extend(!0,{service:"search",wrap:null,data:null,alias:null,serverId:1,global:window},e),t.global=t.option.global?t.option.global:window,t.data=null,t.alias=null,t.wrap=null,t.rollingWrap=null,t.rollingKeywordWrap=null,t.rollingItemInterval=null,t.rollingItemIndex=1,t.listWrap=null,t.listKeywordWrap=null,t.uniqueId=Date.now(),t.proxy={clickDocumentEventHandler:null},t.init()}init(){let e=this;return e.wrap=$(e.option.wrap),isDefined(e.wrap)&&e.wrap.length&&(e.data=e.option.data?e.option.data.list:[],e.data.length&&(e.rollingWrap=$(".keyword__rolling",e.wrap),e.listWrap=$(".keyword__list",e.wrap),e.rollingKeywordWrap=$(".keyword",e.rollingWrap),e.listKeywordWrap=$(".keyword",e.listWrap),e.proxy.clickDocumentEventHandler=$.proxy(e.clickDocumentEventHandler,e),e.setInstance())),e}setInstance(){let e,t,l="",r="";for(let i=0,n=this.data.length;i<n;++i){if(r=encodeURIComponent((e=this.data[i])[0]),t={index:i+1,name:e[0],updown:e[1],rank:e[2],url:""},"-"===r)t.url="javascript:;";else switch(this.option.service){case"search":t.url=`/search?query=${r}`;break;case"item":t.url=`/my/item-search?keyword=${r}`;break;case"powerbook":t.url=`/powerbook/search?query=${r}`}l+=this.getListTpl(t)}this.rollingKeywordWrap.empty().append(l),this.listKeywordWrap.empty().append(l),this.setRollingKeywords(),this.setToggleBtn(),this.setWrapVisible(!1)}setRollingKeywords(){tram($("li",this.rollingKeywordWrap)).set({position:"absolute",top:0,left:0,y:this.rollingKeywordWrap.height()}),this.changeItem(this.rollingItemIndex),this.setRollingKeywordInterval(!0)}setRollingKeywordInterval(e){let t=this;if(t.global.clearInterval(t.rollingItemInterval),t.rollingItemInterval=null,truthy(e)){let l=$("li",t.rollingKeywordWrap);t.rollingItemInterval=t.global.setInterval(()=>{let e=t.rollingItemIndex+1;e>l.length&&(e=1),t.changeItem(e),t.rollingItemIndex=e},t.INTERVAL_ROLLING_ITEMS)}}changeItem(e){let t=this.rollingKeywordWrap.height(),l=this.rollingItemIndex,r=$("li",this.rollingKeywordWrap),i=$(r.get(l-1)),n=$(r.get(e-1));i.length&&tram(i).stop({y:!0}).add("transform 0.9s ease-out-expo").start({y:-t}),n.length&&tram(n).stop({y:!0}).set({y:t}).add("transform 0.9s ease-out-expo").start({y:0})}getListTpl(e){return`<li><a href="${e.url}">${e.name}</a><span class="ui-rank ${e.updown}">${e.rank}</span></li>`}setToggleBtn(){let e=this;$(".btn-toggle",e.wrap).on("click",t=>{t.preventDefault();let l=e.listWrap.is(":visible");e.setDocumentEventHandler(!l),e.setWrapVisible(!l)})}setWrapVisible(e){truthy(e)?(this.wrap.addClass("on"),this.showListWrap(!0)):(this.wrap.removeClass("on"),this.showListWrap(!1))}showListWrap(e){truthy(e)?this.listWrap.show():this.listWrap.hide()}setDocumentEventHandler(e){return $(document).off(`click.ui.realtimekeyword.${this.uniqueId}`,this.proxy.clickDocumentEventHandler),truthy(e)&&$(document).on(`click.ui.realtimekeyword.${this.uniqueId}`,this.proxy.clickDocumentEventHandler),this}clickDocumentEventHandler(e){if("click"===e.type){let t=$(".btn-toggle",this.wrap).get(0),l=$(".keyword__list",this.wrap).get(0);if(e.target===t||e.target===l||$.contains(l,e.target))return;this.setDocumentEventHandler(!1),this.setWrapVisible(!1)}return this}}function searchRealtimeKeyword(e){e&&includeJS("/js/popularkeyword.js",getTime,()=>{includeJS("https://cdn.jsdelivr.net/gh/pjs4020032303-coder/web/js/tram.min.js",cacheVersion,()=>{new RealtimeKeyword($.extend(e,{data:popularKeyword}))})})}