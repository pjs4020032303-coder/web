/*!
 * project : gift
 * author : LINOFFICE
 * N코인 선물하기
 */ account||(window.self.opener?window.self.close():history.back());class Gift{constructor(){$("#userNcoin").text(commaAdd(account.ncoin)),this.nocin_amount=0,this.friend_name=null,this.gift_sync=!1,this.ncoin_input=$("#ncoinAmount"),this.ncoin_msg=$(".ncoin_msg"),this.friend_input=$("#friendName"),this.friend_msg=$(".friend_msg"),this.submit_btn=document.querySelector("#app .wrap .btn_wrap .btn"),this.addEvents()}box_on(s){let n=$(s).parent(".input_box");$(s).val().length?n.hasClass("on")||n.addClass("on"):n.hasClass("on")&&n.removeClass("on")}ncoin_error_msg(s){this.ncoin_msg.text(s),this.ncoin_msg.css("display","block")}friend_error_msg(s){this.friend_msg.text(s),this.friend_msg.css("display","block")}confirm(){let s=this;if(!s.ncoin_input.val()){s.ncoin_error_msg("선물하실 금액을 입력해주세요.");return}if(s.nocin_amount=Number(commaRemove(s.ncoin_input.val())),!account.ncoin||s.nocin_amount>account.ncoin){s.ncoin_error_msg("보유중인 N코인이 부족합니다.");return}if(s.nocin_amount<1e4){s.ncoin_error_msg("10,000코인 이상 선물이 가능합니다.");return}if(!s.friend_input.val()){s.friend_error_msg("선물하실 캐릭터명을 입력해주세요.");return}if(s.friend_name=$("#friendName").val(),s.friend_name.length>20){s.friend_error_msg("캐릭터명이 올바르지 않습니다.");return}if(s.friend_name.match(/\s/g)){s.friend_error_msg("캐릭터명에는 공백이 들어갈 수 없습니다.");return}if(!/^[가-힣|a-z|A-Z|0-9|]+$/.test(s.friend_name)){s.friend_error_msg("캐릭터명이 올바르지 않습니다.");return}if(account.firstChar&&account.firstChar.name==s.friend_name){s.friend_error_msg("자기자신에게는 선물할 수 없습니다.");return}popupShow("정말로 선물하시겠습니까?",`<span class="type2"><a href="#" class="close" id="send_excute">예</a></span>`,`<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>`),document.querySelector("#send_excute").addEventListener("click",n=>{s.send(),eventStop(n)})}send(){let s=this;if(s.gift_sync)return;s.gift_sync=!0,s.ncoin_msg.css("display","none"),s.friend_msg.css("display","none");let n={ncoin_amount:s.nocin_amount,friend_name:s.friend_name};getDatasWithOption([{type:"POST",url:"/define/gift",dataType:"json",contentType:"application/json",Accept:"application/json",data:n}],n=>{switch(n){case 1:popupShow("정상적으로 처리되었습니다.",'<span class="type2"><a href="#" class="close" id="success_close">닫기</a></span>',null),document.querySelector("#success_close").addEventListener("click",s=>{popupClose(),window.self.opener?(window.opener.location.reload(),window.self.close(),eventStop(s)):history.back()});break;case 2:popupShow("인게임에서 이용할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 3:popupShow("계정 정보를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 4:popupShow("대표 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 5:popupShow("인게임 내 케릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 6:popupShow("보유하신 N코인이 부족합니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 7:popupShow("선물 대상을 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 8:popupShow("자기 자신에게는 선물할 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;default:popupShow("선물에 실패하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null)}s.gift_sync=!1},n=>{throw s.gift_sync=!1,Error("send_gift_excute from gift.js Error")})}addEvents(){let s=this,n=isIngame?"keyup":"keydown";setInputToComma(s.ncoin_input),s.ncoin_input.on(n,function(n){s.box_on(this)}),$("#friendName").on(n,function(n){s.box_on(this)}),$(".chargeAmt-reset").on("click",function(s){let n=$(this).parent(".input_box");n.removeClass("on"),n.children("input").val("");let e=n.parent(".present_amount").children(".error_msg");e.text(""),e.css("display","none")}),s.submit_btn.addEventListener("click",n=>{s.confirm()}),$(".scrollbar-macosx").scrollbar()}}new Gift;